default_install_hook_types: [pre-commit]
default_stages: [pre-commit]

repos:
  - repo: local
    hooks:
      - id: black-all
        name: black (all Python)
        entry: bash -c 'black . --exclude="(\.git|\.mypy_cache|\.ruff_cache|\.venv|\.godot|builds|node_modules)"'
        language: system
        stages: [pre-commit]
        pass_filenames: false
        always_run: true
      
      - id: ruff-all
        name: ruff (all Python)
        entry: bash -c 'cd infrastructure/cdk && .venv/bin/ruff check --fix ../.. --exclude="(\.git|\.mypy_cache|\.ruff_cache|\.venv|\.godot|builds|node_modules|addons)"'
        language: system
        stages: [pre-commit]
        pass_filenames: false
        always_run: true
      
      - id: mypy-infrastructure
        name: mypy (infrastructure/cdk)
        entry: bash -c 'cd infrastructure/cdk && .venv/bin/mypy stacks/ tests/'
        language: system
        stages: [pre-commit]
        pass_filenames: false
        always_run: true
      
      - id: mypy-api
        name: mypy (apps/api)
        entry: bash -c 'cd apps/api && pipenv run mypy models/ || true'
        language: system
        stages: [pre-commit]
        pass_filenames: false
        always_run: true
      
      - id: mypy-generated
        name: mypy (generated)
        entry: bash -c 'cd generated/python && python -m mypy models/ || true'
        language: system
        stages: [pre-commit]
        pass_filenames: false
        always_run: true
      
      - id: pytest-cdk
        name: pytest (infrastructure/cdk)
        entry: bash -c 'cd infrastructure/cdk && .venv/bin/pytest tests/unit/ -v'
        language: system
        stages: [pre-commit]
        pass_filenames: false
        always_run: true
      
      - id: godot-unit-tests
        name: Godot unit tests (game-client)
        entry: bash -c 'cd apps/game-client && timeout 30 godot --headless --script addons/gut/gut_cmdln.gd -gdir=res://tests/unit'
        language: system
        stages: [pre-commit]
        pass_filenames: false
        always_run: true
